name: Delete source branch after PR merge

on:
  pull_request:
    types: [closed]

jobs:
  cleanup:
    # ‡∏ó‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏£‡∏ì‡∏µ PR ‡∏ñ‡∏π‡∏Å merge ‡∏à‡∏£‡∏¥‡∏á
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Delete merged branch
        run: |
          BRANCH="${{ github.event.pull_request.head.ref }}"
          echo "üóëÔ∏è Deleting branch: $BRANCH"

          # ‡∏Å‡∏±‡∏ô‡∏û‡∏•‡∏≤‡∏î: ‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏ö main
          if [ "$BRANCH" = "main" ]; then
            echo "‚ùå Refuse to delete main branch"
            exit 0
          fi

          git push origin --delete "$BRANCH"