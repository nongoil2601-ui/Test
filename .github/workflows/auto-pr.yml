name: Auto Create Pull Request and Merge PR
on:
  push:
    branches:
      - 'i'
      - 'oil'
      - 'res'
  
jobs:
  create-and-merge:
    runs-on: ubuntu-latest
    permissions: 
      contents: write
      pull-requests: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á PR
      - name: Create Pull Request
        id: cpr_step
        uses: repo-sync/pull-request@v2
        with:
          source_branch: ${{ github.ref_name }}
          destination_branch: "main"
          pr_title: "PR: ‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡πà‡∏á ${{ github.ref_name }}"
          pr_body: "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏ß‡∏°‡∏£‡πà‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÇ‡∏î‡∏¢ GitHub Action"
          github_token: ${{ secrets.GITHUB_TOKEN }}
          pr_allow_empty: false 
          # pr_allow_empty: false ‡∏Ñ‡∏∑‡∏≠ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏Å‡πâ ‡∏Å‡πá‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á PR

      # ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏™‡∏±‡πà‡∏á Merge ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏Å‡∏¥‡πà‡∏á (‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
      - name: Merge and Delete Branch
        # ‡∏ó‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏•‡∏Ç PR ‡∏™‡πà‡∏á‡∏°‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        if: ${{ steps.cpr_step.outputs.pr_number }}
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á Merge PR ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç ${{ steps.cpr_step.outputs.pr_number }}..."
          
          # ‡∏™‡∏±‡πà‡∏á Merge ‡πÅ‡∏•‡∏∞ ‡∏•‡∏ö‡∏Å‡∏¥‡πà‡∏á‡∏ó‡∏¥‡πâ‡∏á (--delete-branch) ‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
          gh pr merge ${{ steps.cpr_step.outputs.pr_number }} --merge --auto --delete-branch
          
          echo "‚úÖ Merge ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏Å‡∏¥‡πà‡∏á ${{ github.ref_name }} ‡∏ö‡∏ô GitHub ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß"