name: Auto Create Pull Request and Merge PR
on:
  push:
    branches:
      - 'i'
      - 'oil'
      - 'res'
      # ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡πà‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà

jobs:
  auto-process:
    runs-on: ubuntu-latest
    permissions: 
      contents: write      # ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πâ‡∏î (Merge/Delete)
      pull-requests: write # ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö PR
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á PR
      - name: Create Pull Request
        id: cpr
        uses: repo-sync/pull-request@v2
        with:
          source_branch: ${{ github.ref_name }}
          destination_branch: "main"
          pr_title: "Auto-Merge: ‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡πà‡∏á ${{ github.ref_name }}"
          pr_body: "‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥: ‡∏™‡∏£‡πâ‡∏≤‡∏á PR, Merge ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡∏•‡∏ö‡∏Å‡∏¥‡πà‡∏á‡∏ó‡∏¥‡πâ‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ"
          github_token: ${{ secrets.GITHUB_TOKEN }}
          pr_allow_empty: false 

      # 2. Merge ‡πÅ‡∏•‡∏∞ ‡∏•‡∏ö‡∏Å‡∏¥‡πà‡∏á (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á PR ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)
      - name: Merge and Delete Branch
        if: ${{ steps.cpr.outputs.pr_number }}
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "üöÄ ‡∏û‡∏ö PR ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç ${{ steps.cpr.outputs.pr_number }} ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£..."
          
          # ‡∏™‡∏±‡πà‡∏á Merge ‡πÅ‡∏ö‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ confirm) ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏Å‡∏¥‡πà‡∏á‡∏ó‡∏¥‡πâ‡∏á (--delete-branch)
          gh pr merge ${{ steps.cpr.outputs.pr_number }} --merge --delete-branch
          
          echo "‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡∏£‡∏ß‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Ç‡πâ‡∏≤ Main ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏Å‡∏¥‡πà‡∏á ${{ github.ref_name }} ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å GitHub ‡πÅ‡∏•‡πâ‡∏ß"